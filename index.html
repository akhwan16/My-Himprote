<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="login.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
</head>
<body>
    <div class="container">
      <div class="navbar">
        <nav>
          <img src="Assets/img/Group 75.png" alt="Logo" />
        </nav>
      </div>
      <div class="login-button">
        <div class="content">
          Masuk Dengan Email UNNES
          <form id="loginForm" method="post" action="../check_login.php"> <!-- Menambahkan formulir dan aksi -->
            <input type="hidden" id="email" name="email"> <!-- Input tersembunyi untuk menyimpan email -->
            <button type="button" onclick="loginWithGoogle()"> <!-- Mengganti tipe tombol menjadi "button" -->
              <img src="Assets/img/google.png" alt="Google Logo" />Sign With Google
            </button>
          </form>
        </div>
      </div>
    </div>
    <script>
      
      function loginWithGoogle() {
          // URL untuk autentikasi dengan Google
          var authUrl = "https://accounts.google.com/o/oauth2/auth";
          // Parameter yang diperlukan untuk autentikasi OAuth dengan Google
          var params = {
              client_id: "482588250991-3shi05uql873ibpskvvt2jtia9nh720g.apps.googleusercontent.com",
              redirect_uri: "http://localhost:3000",
              response_type: "token",
              scope: "email profile", // Anda dapat menyesuaikan ruang lingkup (scope) sesuai kebutuhan aplikasi Anda
          };
          // Membangun URL autentikasi dengan parameter yang diberikan
          var authQueryString = Object.keys(params)
              .map((key) => key + "=" + encodeURIComponent(params[key]))
              .join("&");
          var authUrlWithParams = authUrl + "?" + authQueryString;
          // Redirect ke halaman autentikasi Google
          window.location.href = authUrlWithParams;
      }
  
      function handleLoginResponse() {
          var token = new URLSearchParams(window.location.hash.substr(1)).get("access_token");
          if (token) {
              // Panggil fungsi untuk mengambil informasi pengguna setelah berhasil login
              getUserInfo(token);
          }
      }
  
      function getUserInfo(token) {
          // Mengirim permintaan ke Google API untuk mendapatkan informasi pengguna dengan token
          // Anda perlu menyesuaikan URL API sesuai dengan dokumentasi Google
          var userInfoUrl = "https://www.googleapis.com/oauth2/v3/userinfo?access_token=" + token;
  
          // Mengirim permintaan AJAX
          var xhr = new XMLHttpRequest();
          xhr.open("GET", userInfoUrl, true);
          xhr.onreadystatechange = function () {
              if (xhr.readyState === XMLHttpRequest.DONE) {
                  if (xhr.status === 200) {
                      // Jika permintaan berhasil, ambil informasi pengguna
                      var response = JSON.parse(xhr.responseText);
                      var email = response.email; // Ambil email pengguna dari respons
                      document.getElementById("email").value = email; // Setel nilai input tersembunyi dengan email
                      document.getElementById("loginForm").submit(); // Kirim formulir
                  } else {
                      console.error("Failed to fetch user info:", xhr.status);
                  }
              }
          };
          xhr.send();
      }
  
      handleLoginResponse(); // Panggil fungsi untuk menangani respons setelah login
    </script>
  
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
